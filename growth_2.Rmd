---
title: "growth_2"
author: "Kane Russell"
date: "12/9/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
#install.packages("ggpubr")
library(ggpubr)
```

## Data

```{r}
treatments <- data.frame(TRT = c("M", "MH", "MBB", "BB"), 
                         Treatment = c("Mastication Only", "Mastication + Herbicide", "Mastication + Burn", "Burn Only" ))
treatments

grow_RBA_ac <- 
  read.csv("grow_RBA_ac.csv") %>% 
  select(-X, -X.1, -X.2, -X.3) %>% 
  mutate(COMPGAP = paste0(COMP, GAP)) %>% 
  mutate(RGR_2 = (BA_18_AC - BA_13_AC)/(BA_13_AC*5)) %>% 
  arrange(factor(TRT, levels = c("M", "MH", "MBB", "BB"))) %>% 
  left_join(treatments)
grow_RBA_ac
```

```{r}
grow_RBA_ac %>% 
  group_by(TRT) %>% 
  summarise(mean = mean(RGR_BA_AC))
```

## ANOVA

```{r}
RBA_aov <- aov(RGR_BA_AC ~ TRT, data = grow_RBA_ac)
sum_RBA_aov <- summary(RBA_aov)
str(sum_RBA_aov)
sum_RBA_aov[[1]][["Pr(>F)"]][[1]]
```

## Tukey's HSD

```{r}
Tuk_RBA <- TukeyHSD(RBA_aov)
Tuk_RBA
plot(Tuk_RBA)
```

## Plotting

```{r}
 ggplot() + 
  geom_boxplot(data = grow_RBA_ac, 
               aes(x = factor(Treatment, c("Mastication Only", "Mastication + Herbicide", "Mastication + Burn", "Burn Only")), 
                   y = RGR_BA_AC)) + 
  geom_bracket(xmin = "Mastication + Herbicide", xmax = "Burn Only", y.position = 0.26, 
                   label = "Tukey's HSD, p < 0.05") + 
  geom_label(aes(x = "Mastication Only", y = 0.25, label = "1-way ANOVA, \np < 0.05")) + 
  labs(x = "Treatment", 
       y = "Mean relative growth rate of basal area (1/year)")
```

```{r}
tky <- as.data.frame(Tuk_RBA$TRT)
tky$pair <- rownames(tky)
  ggplot(tky, aes(colour=cut(`p adj`, c(0, 0.01, 0.05, 1), 
                           label=c("p<0.01","p<0.05","Non-Sig")))) +
  geom_hline(yintercept=0, lty="11", colour="grey30") +
  geom_errorbar(aes(pair, ymin=lwr, ymax=upr), width=0.2) +
  geom_point(aes(pair, diff)) +
  labs(colour="")
  
```


Chi-Squares Analysis

```{r}
growth <- 
  read.csv("TAYSR_CompiledGrowthData_2013_2018.csv")
colnames(growth)[colnames(growth)=="TREATMENT"] <- "TRT"
colnames(growth)[colnames(growth)=="SPECIES"] <- "SPP"
growth_out <- growth[-c(153),]
fgrow <- 
  growth_out %>% 
  filter(SPP %in% c("DF", "IC", "PP", "SP", "WF"))

table(growth_out$COMPGAP, growth_out$SPP) %>% 
chisq.test()
```

```{r}
sppcomp_mtx <- 
  read_csv("spp_comp.csv") %>%
  select(-X1, -X7, -X8, -X9, -X10, -X11, -X12, -X13, -X14) %>%
  filter(!is.na(DF)) %>% 
  data.matrix()
rownames(sppcomp_mtx) <- c("10O", "10Q", "30A", "30B", "50D", "50E", "60F", "60G", "60H", "60I", "60J", "400F", "400G", "400H")
sppcomp_mtx

```


```{r}
#install.packages("corrplot")
library(corrplot)
chisq <- chisq.test(sppcomp_mtx, p = c(0.2, 0.2, 0.2, 0.2, 0.2))
chisq
```

```{r}
contrib <- 100*chisq$residuals^2/chisq$statistic
round(contrib, 3)
corrplot(contrib, is.cor = FALSE)
```



```{r}
spp_comp_trt <- 
  spp_comp %>% 
  group_by(TRT, SPP) %>% 
  summarise(avg = median(count))

sppcomp_trt_mtx <- matrix(data = spp_comp_trt$avg, 
       nrow = 4, 
       ncol = 5, 
       byrow = TRUE, 
       dimnames = list(c("BB", "M", "MBB", "MH"), c("DF", "IC", "PP", "SP", "WF")))
sppcomp_trt_mtx
```

```{r}
chisq.test(sppcomp_trt_mtx)
fisher.test(sppcomp_trt_mtx)
```

