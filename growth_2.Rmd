---
title: "growth_2"
author: "Kane Russell"
date: "12/9/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
#install.packages("ggpubr")
library(ggpubr)
```

## Data

```{r}
treatments <- data.frame(TRT = c("M", "MH", "MBB", "BB"), 
                         Treatment = c("Mastication Only", "Mastication + Herbicide", "Mastication + Burn", "Burn Only" ))
treatments

grow_RBA_ac <- 
  read.csv("grow_RBA_ac.csv") %>% 
  select(-X, -X.1, -X.2, -X.3) %>% 
  mutate(COMPGAP = paste0(COMP, GAP)) %>% 
  mutate(RGR_2 = (BA_18_AC - BA_13_AC)/(BA_13_AC*5)) %>% 
  arrange(factor(TRT, levels = c("M", "MH", "MBB", "BB"))) %>% 
  left_join(treatments)
grow_RBA_ac
```

```{r}
grow_RBA_ac %>% 
  group_by(TRT) %>% 
  summarise(mean = mean(RGR_BA_AC))
```

## ANOVA

```{r}
RBA_aov <- aov(RGR_BA_AC ~ TRT, data = grow_RBA_ac)
sum_RBA_aov <- summary(RBA_aov)
sum_RBA_aov
```

```{r}
RBA2_aov <- aov(RGR_2 ~ TRT, data = grow_RBA_ac)
sum_RBA2_aov <- summary(RBA_aov)
sum_RBA2_aov
```


## Tukey's HSD

```{r}
Tuk_RBA <- TukeyHSD(RBA_aov)
Tuk_RBA
plot(Tuk_RBA)
```

```{r}
Tuk_RBA2 <- TukeyHSD(RBA2_aov)
Tuk_RBA2
plot(Tuk_RBA2)
```


## Plotting

```{r}
 ggplot() + 
  geom_boxplot(data = grow_RBA_ac, 
               aes(x = factor(Treatment, c("Mastication + Herbicide", "Mastication Only",  "Mastication + Burn", "Burn Only")), 
                   y = RGR_2)) + 
  #geom_bracket(xmin = "Mastication + Herbicide", xmax = "Mastication + Burn", 
  #             y.position = 0.26, label = "") +
  #geom_bracket(x = "Mastication + Herbicide", xmax = "Mastication Only", 
  #             y.position =  0.26, label = "") +
  #geom_bracket(x = "Mastication Only", xmax = "Burn Only", 
  #             y.position = 0.25, label = "") +
  #geom_bracket(x = "Mastication Only", xmax = "Mastication + Burn", 
  #             y.position = 0.25, label = "") +
  #geom_bracket(x = "Mastication + Burn", xmax = "Burn Only", 
  #             y.position = 0.25, label = "") +
  geom_segment(aes(x = "Mastication + Herbicide", xend = "Mastication + Burn", 
                   y = 0.48, yend = 0.48)) + 
  geom_segment(aes(x = "Mastication Only", xend = "Burn Only", 
                   y = 0.46, yend = 0.46)) + 
  labs(x = "Treatment", 
       y = "Relative basal area increment (%/year)", 
       caption = "Note: Horizontal lines indicate treatments that are not significantly different, using Tukey's HSD")
```

```{r}
tky <- as.data.frame(Tuk_RBA$TRT)
tky$pair <- rownames(tky)
  ggplot(tky, aes(colour=cut(`p adj`, c(0, 0.01, 0.05, 1), 
                           label=c("p<0.01","p<0.05","Non-Sig")))) +
  geom_hline(yintercept=0, lty="11", colour="grey30") +
  geom_errorbar(aes(pair, ymin=lwr, ymax=upr), width=0.2) +
  geom_point(aes(pair, diff)) +
  labs(colour="")
  
```


Chi-Squares Analysis

```{r}
growth <- 
  read.csv("TAYSR_CompiledGrowthData_2013_2018.csv")
colnames(growth)[colnames(growth)=="TREATMENT"] <- "TRT"
colnames(growth)[colnames(growth)=="SPECIES"] <- "SPP"
growth_out <- growth[-c(153),]
fgrow <- 
  growth_out %>% 
  filter(SPP %in% c("DF", "IC", "PP", "SP", "WF"))

spp_comp <-
  table(growth_out$COMPGAP, growth_out$SPP)
spp_comp
```


```{r}
#install.packages("corrplot")
library(corrplot)
chisq <- chisq.test(spp_comp)
chisq
```

```{r}
contrib <- 100*chisq$residuals^2/chisq$statistic
corrplot(contrib, is.cor = FALSE)
```



```{r}
spp_comp_trt <- 
  table(fgrow$TRT, fgrow$SPP)[, -c(1, 3, 7)]
spp_comp_trt
```

```{r}
chisq.test(spp_comp_trt)
fisher.test(spp_comp_trt)
```

