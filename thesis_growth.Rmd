---
title: "thesis_growth"
author: "Kane Russell"
date: "9/9/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(ggplot2)
library(nlme)
library(dplyr)
library(car)
growth <- 
  read.csv("TAYSR_CompiledGrowthData_2013_2018.csv")
growth <- 
  growth %>% 
  mutate(RGR_BA = BAI/BA_2013)
growth$COMP <- factor(growth$COMP)
colnames(growth)[colnames(growth)=="TREATMENT"] <- "TRT"
colnames(growth)[colnames(growth)=="SPECIES"] <- "SPP"
head(growth)
```

```{r}
growth_out <- growth[-c(153),] 
growth_out
```


### Initial Data Visualization

```{r}
ANNINC_boxplot <- 
  ggplot(growth) + 
  geom_boxplot(aes(x = TRT, y = ANN_INC), varwidth = TRUE)
ANNINC_boxplot
```

```{r}
RGR_boxplot <- 
  ggplot(growth) + 
  geom_boxplot(aes(x = TRT, y = RGR), varwidth = TRUE)
RGR_boxplot
```

```{r}
BAI_boxplot <- 
  ggplot(growth) + 
  geom_boxplot(aes(x = TRT, y = BAI), varwidth = TRUE)
BAI_boxplot
```


```{r}
DBH_2013_hist <- 
  ggplot(growth) + 
  geom_histogram(aes(x = DBH_2013), binwidth = 1) 
DBH_2013_hist
```

```{r}
DBH_2018_hist <- 
  ggplot(growth) + 
  geom_histogram(aes(x = DBH_2018), binwidth = 1)
DBH_2018_hist
```

```{r}
PVCS_densityplot <-
  ggplot(growth) + 
  geom_density(aes(x = PVCS_2013)) + 
  geom_density(aes(x = PVCS_2018), color = "red") + 
  xlab("PVCS")
PVCS_densityplot
```


```{r}
mean_ANN_INC <- summarize(group_by(growth, TRT), mean_RGR = mean(ANN_INC))
mean_ANN_INC
```


```{r}
ANN_INC_by_trt <- 
  ggplot() + 
  geom_boxplot(data = growth, aes(x = TRT, y = ANN_INC, group = COMPGAP, color = factor(COMP))) + 
  geom_point(data = mean_ANN_INC, aes(x = TRT, y = mean_RGR), color = "red", shape = 4, size = 4)
ANN_INC_by_trt
```
```{r}
mean_RGR <- summarize(group_by(growth_out, TRT), mean_RGR = mean(RGR))
mean_RGR
```


```{r}
RGR_by_trt <- 
  ggplot() + 
  geom_boxplot(data = growth_out, aes(x = TRT, y = RGR, group = COMPGAP, color = factor(COMP))) + 
  geom_point(data = mean_RGR, aes(x = TRT, y = mean_RGR), color = "red", shape = 4, size = 4)
RGR_by_trt
```


```{r}
mean_BAI <- summarize(group_by(growth, TRT), mean_BAI = mean(BAI))
mean_BAI
BAI_by_trt <- 
  ggplot() + 
  geom_boxplot(data = growth, aes(x = TRT, y = BAI, group = COMPGAP, color = COMP)) + 
  geom_point(data = mean_BAI, aes(x = TRT, y = mean_BAI), color = "red", shape = 4, size = 4)
BAI_by_trt
```

```{r}
mean_RGR_BA <- summarize(group_by(growth_out, TRT), mean_RGR_BA = mean(RGR_BA))
mean_RGR_BA
RGR_BA_by_trt <- 
  ggplot() + 
  geom_boxplot(data = growth_out, aes(x = TRT, y = RGR_BA, group = COMPGAP, color = factor(COMP))) + 
  geom_point(data = mean_RGR_BA, aes(x = TRT, y = mean_RGR_BA), color = "red", shape = 4, size = 4)
RGR_BA_by_trt
```


```{r}
ANN_INC_spp <- 
  ggplot(growth) + 
  geom_boxplot(aes(x = SPP, y = ANN_INC))
ANN_INC_spp

RGR_spp <- 
  ggplot(growth) + 
  geom_boxplot(aes(x = SPP, y = RGR))
RGR_spp

BAI_spp <- 
  ggplot(growth) + 
  geom_boxplot(aes(x = SPP, y = BAI))
BAI_spp

RGR_BA_spp <-
  ggplot(growth_out) + 
  geom_boxplot(aes(x = SPP, y = RGR_BA))
RGR_BA_spp
```




### Modeling

```{r}
M.lm <- gls(ANN_INC ~ TRT + SPP, data = growth)
plot(resid(M.lm) ~ growth$TRT)
plot(resid(M.lm) ~ growth$SPP)
summary(M.lm)
```

```{r}
vf2 <- varIdent(form= ~ 1 | TRT * SPP)
M.identvar <- gls(ANN_INC ~ TRT + SPP, data = growth, weights = vf2)
summary(M.identvar)
```

```{r}
E2 <- resid(M.identvar, type = "normalized")
coplot(E2 ~ TRT | SPP, data = growth,
ylab = "Normalised residuals")
```

```{r}
anova(M.lm, M.identvar)
```

```{r}
M.lm2 <- lm(data = growth, RGR ~ TRT + SPP + COMP + TRT:SPP)
summary(M.lm2)
```


```{r}
Z <- cbind(growth$TRT, growth$SPP, growth$COMP,
growth$P_NP, growth$HTCB_2013)
colnames(Z) <- c("TRT", "SPP", "COMP",
"P_NP", "HTCB_2013")
pairs(Z, lower.panel = panel.smooth2,
upper.panel = panel.cor, diag.panel = panel.hist)
```



